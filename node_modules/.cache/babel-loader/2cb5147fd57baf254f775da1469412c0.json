{"ast":null,"code":"var _jsxFileName = \"/home/carlos/Escritorio/proyecto progra/cloneWp/src/context/usersContext.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport contacts from \"data/contacts\";\nimport { useSocketContext } from \"./socketContext\";\nimport { io } from \"socket.io-client\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst UsersContext = /*#__PURE__*/createContext();\n\nconst useUsersContext = () => {\n  _s();\n\n  return useContext(UsersContext);\n};\n\n_s(useUsersContext, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nconst UsersProvider = ({\n  children\n}) => {\n  _s2();\n\n  const socket = useSocketContext();\n  const [users, setUsers] = useState(contacts);\n\n  const _updateUserProp = (userId, prop, value) => {\n    setUsers(users => {\n      const usersCopy = [...users];\n      let userIndex = users.findIndex(user => user.id === userId);\n      const userObject = usersCopy[userIndex];\n      usersCopy[userIndex] = { ...userObject,\n        [prop]: value\n      }; //\tconsole.log(usersCopy[userIndex].id+\"   envia\");\n\n      return usersCopy;\n    });\n  };\n\n  const setUserAsUnread = userId => {\n    _updateUserProp(userId, \"unread\", 0); //\tconsole.log(userId+\"   r1111egresa\");\n\n  };\n\n  const setUserAsTyping = data => {\n    const {\n      userId\n    } = data;\n\n    _updateUserProp(userId, \"typing\", true);\n  };\n\n  const setUserAsNotTyping = data => {\n    const {\n      userId\n    } = data;\n\n    _updateUserProp(userId, \"typing\", false);\n  }; /////////////////////////////////////////////////////////\n\n  /*\tconst fetchMessageResponse = (data) => {\n  \t\tsetUsers((users) => {\n  \t\t\tconst { sender, response } = data;\n  console.log(data);\n  \t\t\tlet userIndex = users.findIndex((user) => user.id === userId);\n  \t\t\tconst usersCopy = JSON.parse(JSON.stringify(users));\n  \t\t\tconst newMsgObject = {\n  \t\t\t\tcontent: response,\n  \t\t\t\tsender: userId,\n  \t\t\t\ttime: new Date().toLocaleTimeString(),\n  \t\t\t\tstatus: null,\n  \t\t\t};\n  \n  \t\t\tusersCopy[userIndex].messages.TODAY.push(newMsgObject);\n  \n  \n  \t\t\treturn usersCopy;\n  \t\t});\n  \t};\n  \t*/\n\n\n  useEffect(() => {\n    socket.on(\"getMessage\", data => {\n      //\tconsole.log(data);\n\n      /*\tsetArrivalMessage({\n      \t\tsender: data.idUsu,\n      \t\tcontent: data.message,\n      \t\tcreatedAt: Date.now(),\n      \t});*/\n      //console.log(data)\n      fetchMessageResponse(data); //console.log(arrivalMessage+\"          holaaaaaaaaaaaaaa\");\n    });\n  }, []);\n\n  const fetchMessageResponse = data => {\n    setUsers(users => {\n      console.log(users);\n      const {\n        idUsu,\n        message\n      } = data;\n      let userIndex = idUsu - 1; //console.log(idUsu);\n      //\t\tconst isLargeNumber = (element) => element.id===Number(idUsu)[0] ;\n      //\t\tconsole.log(users.findIndex(isLargeNumber));\n      //let user = Carlos.filter((user) => user.id === Number(idUsu))[0];\n      //\tlet userIndex = users.filter((user) => user.id === idUsu);\n      //\tuserIndex=userIndex+idUsu;\n\n      const usersCopy = JSON.parse(JSON.stringify(users));\n      console.log(userIndex);\n      const newMsgObject = {\n        content: message,\n        sender: idUsu,\n        time: new Date().toLocaleTimeString(),\n        status: null\n      };\n      usersCopy[userIndex].messages.TODAY.push(newMsgObject);\n      console.log(newMsgObject);\n      return usersCopy;\n    });\n  };\n\n  const addNewMessage = (userId, message, idUsu) => {\n    let userIndex = users.findIndex(user => user.id === userId); //console.log(userId, message,idUsu)\n\n    const usersCopy = [...users];\n    const newMsgObject = {\n      sender: null,\n      content: message,\n      receiver: userId,\n      time: new Date().toLocaleTimeString(),\n      status: \"delivered\"\n    }; //////////\n    //\tconsole.log(newMsgObject);\n\n    usersCopy[userIndex].messages.TODAY.push(newMsgObject);\n    setUsers(usersCopy);\n    socket.emit(\"sendMessage\", {\n      userId,\n      message,\n      idUsu\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(UsersContext.Provider, {\n    value: {\n      users,\n      setUserAsUnread,\n      addNewMessage\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 165,\n    columnNumber: 3\n  }, this);\n};\n\n_s2(UsersProvider, \"LC5GzhZveEn7GQt3l37fsnJ/FPk=\", false, function () {\n  return [useSocketContext];\n});\n\n_c = UsersProvider;\nexport { useUsersContext, UsersProvider };\n\nvar _c;\n\n$RefreshReg$(_c, \"UsersProvider\");","map":{"version":3,"sources":["/home/carlos/Escritorio/proyecto progra/cloneWp/src/context/usersContext.js"],"names":["createContext","useContext","useEffect","useState","contacts","useSocketContext","io","UsersContext","useUsersContext","UsersProvider","children","socket","users","setUsers","_updateUserProp","userId","prop","value","usersCopy","userIndex","findIndex","user","id","userObject","setUserAsUnread","setUserAsTyping","data","setUserAsNotTyping","on","fetchMessageResponse","console","log","idUsu","message","JSON","parse","stringify","newMsgObject","content","sender","time","Date","toLocaleTimeString","status","messages","TODAY","push","addNewMessage","receiver","emit"],"mappings":";;;;AAAA,SAASA,aAAT,EAAwBC,UAAxB,EAAoCC,SAApC,EAA+CC,QAA/C,QAA+D,OAA/D;AACA,OAAOC,QAAP,MAAqB,eAArB;AACA,SAASC,gBAAT,QAAgC,iBAAhC;AACA,SAAQC,EAAR,QAAiB,kBAAjB;;AAEA,MAAMC,YAAY,gBAAGP,aAAa,EAAlC;;AAEA,MAAMQ,eAAe,GAAG;AAAA;;AAAA,SAAMP,UAAU,CAACM,YAAD,CAAhB;AAAA,CAAxB;;GAAMC,e;;AAEN,MAAMC,aAAa,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAkB;AAAA;;AAEvC,QAAMC,MAAM,GAAGN,gBAAgB,EAA/B;AAKA,QAAM,CAACO,KAAD,EAAQC,QAAR,IAAoBV,QAAQ,CAACC,QAAD,CAAlC;;AAEA,QAAMU,eAAe,GAAG,CAACC,MAAD,EAASC,IAAT,EAAeC,KAAf,KAAyB;AAChDJ,IAAAA,QAAQ,CAAED,KAAD,IAAW;AACnB,YAAMM,SAAS,GAAG,CAAC,GAAGN,KAAJ,CAAlB;AACA,UAAIO,SAAS,GAAGP,KAAK,CAACQ,SAAN,CAAiBC,IAAD,IAAUA,IAAI,CAACC,EAAL,KAAYP,MAAtC,CAAhB;AACA,YAAMQ,UAAU,GAAGL,SAAS,CAACC,SAAD,CAA5B;AACAD,MAAAA,SAAS,CAACC,SAAD,CAAT,GAAuB,EAAE,GAAGI,UAAL;AAAiB,SAACP,IAAD,GAAQC;AAAzB,OAAvB,CAJmB,CAKpB;;AACC,aAAOC,SAAP;AAEA,KARO,CAAR;AASA,GAVD;;AAcA,QAAMM,eAAe,GAAIT,MAAD,IAAY;AACnCD,IAAAA,eAAe,CAACC,MAAD,EAAS,QAAT,EAAmB,CAAnB,CAAf,CADmC,CAGpC;;AACC,GAJD;;AAWA,QAAMU,eAAe,GAAIC,IAAD,IAAU;AACjC,UAAM;AAAEX,MAAAA;AAAF,QAAaW,IAAnB;;AACAZ,IAAAA,eAAe,CAACC,MAAD,EAAS,QAAT,EAAmB,IAAnB,CAAf;AACA,GAHD;;AAKA,QAAMY,kBAAkB,GAAID,IAAD,IAAU;AACpC,UAAM;AAAEX,MAAAA;AAAF,QAAaW,IAAnB;;AACAZ,IAAAA,eAAe,CAACC,MAAD,EAAS,QAAT,EAAmB,KAAnB,CAAf;AACA,GAHD,CAvCuC,CA2CxC;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAECb,EAAAA,SAAS,CAAC,MAAM;AAEfS,IAAAA,MAAM,CAACiB,EAAP,CAAU,YAAV,EAAyBF,IAAD,IAAU;AAClC;;AACA;AACF;AACA;AACA;AACA;AACG;AACAG,MAAAA,oBAAoB,CAACH,IAAD,CAApB,CARiC,CASjC;AAEA,KAXD;AAYA,GAdQ,EAcN,EAdM,CAAT;;AAiBA,QAAMG,oBAAoB,GAAIH,IAAD,IAAU;AAGtCb,IAAAA,QAAQ,CAAED,KAAD,IAAW;AACnBkB,MAAAA,OAAO,CAACC,GAAR,CAAYnB,KAAZ;AACA,YAAM;AAAEoB,QAAAA,KAAF;AAASC,QAAAA;AAAT,UAAqBP,IAA3B;AAEA,UAAIP,SAAS,GAAEa,KAAK,GAAC,CAArB,CAJmB,CAOtB;AAEC;AACA;AACE;AACD;AACA;;AACC,YAAMd,SAAS,GAAGgB,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAexB,KAAf,CAAX,CAAlB;AAEHkB,MAAAA,OAAO,CAACC,GAAR,CAAYZ,SAAZ;AAEG,YAAMkB,YAAY,GAAG;AACpBC,QAAAA,OAAO,EAAEL,OADW;AAEpBM,QAAAA,MAAM,EAAEP,KAFY;AAGpBQ,QAAAA,IAAI,EAAE,IAAIC,IAAJ,GAAWC,kBAAX,EAHc;AAIpBC,QAAAA,MAAM,EAAE;AAJY,OAArB;AAOAzB,MAAAA,SAAS,CAACC,SAAD,CAAT,CAAqByB,QAArB,CAA8BC,KAA9B,CAAoCC,IAApC,CAAyCT,YAAzC;AACAP,MAAAA,OAAO,CAACC,GAAR,CAAYM,YAAZ;AACA,aAAOnB,SAAP;AACA,KA5BO,CAAR;AA6BA,GAhCD;;AA4CA,QAAM6B,aAAa,GAAG,CAAChC,MAAD,EAASkB,OAAT,EAAiBD,KAAjB,KAA2B;AAChD,QAAIb,SAAS,GAAGP,KAAK,CAACQ,SAAN,CAAiBC,IAAD,IAAUA,IAAI,CAACC,EAAL,KAAYP,MAAtC,CAAhB,CADgD,CAElD;;AACE,UAAMG,SAAS,GAAG,CAAC,GAAGN,KAAJ,CAAlB;AACA,UAAMyB,YAAY,GAAG;AAGpBE,MAAAA,MAAM,EAAC,IAHa;AAIpBD,MAAAA,OAAO,EAAEL,OAJW;AAKpBe,MAAAA,QAAQ,EAACjC,MALW;AAOpByB,MAAAA,IAAI,EAAE,IAAIC,IAAJ,GAAWC,kBAAX,EAPc;AAQpBC,MAAAA,MAAM,EAAE;AARY,KAArB,CAJgD,CAiBhD;AAED;;AAECzB,IAAAA,SAAS,CAACC,SAAD,CAAT,CAAqByB,QAArB,CAA8BC,KAA9B,CAAoCC,IAApC,CAAyCT,YAAzC;AACAxB,IAAAA,QAAQ,CAACK,SAAD,CAAR;AAEAP,IAAAA,MAAM,CAACsC,IAAP,CAAY,aAAZ,EAA2B;AAAClC,MAAAA,MAAD;AAAQkB,MAAAA,OAAR;AAAgBD,MAAAA;AAAhB,KAA3B;AACA,GAzBD;;AA4BA,sBACC,QAAC,YAAD,CAAc,QAAd;AAAuB,IAAA,KAAK,EAAE;AAAEpB,MAAAA,KAAF;AAASY,MAAAA,eAAT;AAA0BuB,MAAAA;AAA1B,KAA9B;AAAA,cACErC;AADF;AAAA;AAAA;AAAA;AAAA,UADD;AAKA,CA/JD;;IAAMD,a;UAEUJ,gB;;;KAFVI,a;AAiKN,SAASD,eAAT,EAA0BC,aAA1B","sourcesContent":["import { createContext, useContext, useEffect, useState } from \"react\";\nimport contacts from \"data/contacts\";\nimport { useSocketContext} from \"./socketContext\";\nimport {io} from \"socket.io-client\";\n\nconst UsersContext = createContext();\n\nconst useUsersContext = () => useContext(UsersContext);\n\nconst UsersProvider = ({ children }) => {\n\n\tconst socket = useSocketContext();\n\n\n\n\n\tconst [users, setUsers] = useState(contacts);\n\n\tconst _updateUserProp = (userId, prop, value) => {\n\t\tsetUsers((users) => {\n\t\t\tconst usersCopy = [...users];\n\t\t\tlet userIndex = users.findIndex((user) => user.id === userId);\n\t\t\tconst userObject = usersCopy[userIndex];\n\t\t\tusersCopy[userIndex] = { ...userObject, [prop]: value };\n\t\t//\tconsole.log(usersCopy[userIndex].id+\"   envia\");\n\t\t\treturn usersCopy;\n\n\t\t});\n\t};\n\n\n\n\tconst setUserAsUnread = (userId) => {\n\t\t_updateUserProp(userId, \"unread\", 0);\n\n\t//\tconsole.log(userId+\"   r1111egresa\");\n\t};\n\n\n\n\n\n\n\tconst setUserAsTyping = (data) => {\n\t\tconst { userId } = data;\n\t\t_updateUserProp(userId, \"typing\", true);\n\t};\n\n\tconst setUserAsNotTyping = (data) => {\n\t\tconst { userId } = data;\n\t\t_updateUserProp(userId, \"typing\", false);\n\t};\n/////////////////////////////////////////////////////////\n/*\tconst fetchMessageResponse = (data) => {\n\t\tsetUsers((users) => {\n\t\t\tconst { sender, response } = data;\nconsole.log(data);\n\t\t\tlet userIndex = users.findIndex((user) => user.id === userId);\n\t\t\tconst usersCopy = JSON.parse(JSON.stringify(users));\n\t\t\tconst newMsgObject = {\n\t\t\t\tcontent: response,\n\t\t\t\tsender: userId,\n\t\t\t\ttime: new Date().toLocaleTimeString(),\n\t\t\t\tstatus: null,\n\t\t\t};\n\n\t\t\tusersCopy[userIndex].messages.TODAY.push(newMsgObject);\n\n\n\t\t\treturn usersCopy;\n\t\t});\n\t};\n\t*/\n\n\tuseEffect(() => {\n\n\t\tsocket.on(\"getMessage\", (data) => {\n\t\t//\tconsole.log(data);\n\t\t/*\tsetArrivalMessage({\n\t\t\t\tsender: data.idUsu,\n\t\t\t\tcontent: data.message,\n\t\t\t\tcreatedAt: Date.now(),\n\t\t\t});*/\n\t\t\t//console.log(data)\n\t\t\tfetchMessageResponse(data);\n\t\t\t//console.log(arrivalMessage+\"          holaaaaaaaaaaaaaa\");\n\n\t\t});\n\t}, []);\n\n\n\tconst fetchMessageResponse = (data) => {\n\n\n\t\tsetUsers((users) => {\n\t\t\tconsole.log(users);\n\t\t\tconst { idUsu, message } = data;\n\n\t\t\tlet userIndex =idUsu-1;\n\n\n//console.log(idUsu);\n\n\t//\t\tconst isLargeNumber = (element) => element.id===Number(idUsu)[0] ;\n\t//\t\tconsole.log(users.findIndex(isLargeNumber));\n\t\t\t//let user = Carlos.filter((user) => user.id === Number(idUsu))[0];\n\t\t//\tlet userIndex = users.filter((user) => user.id === idUsu);\n\t\t//\tuserIndex=userIndex+idUsu;\n\t\t\tconst usersCopy = JSON.parse(JSON.stringify(users));\n\nconsole.log(userIndex);\n\n\t\t\tconst newMsgObject = {\n\t\t\t\tcontent: message,\n\t\t\t\tsender: idUsu,\n\t\t\t\ttime: new Date().toLocaleTimeString(),\n\t\t\t\tstatus: null,\n\t\t\t};\n\n\t\t\tusersCopy[userIndex].messages.TODAY.push(newMsgObject);\n\t\t\tconsole.log(newMsgObject);\n\t\t\treturn usersCopy;\n\t\t});\n\t};\n\n\n\n\n\n\n\n\n\n\n\n\tconst addNewMessage = (userId, message,idUsu) => {\n\t\tlet userIndex = users.findIndex((user) => user.id === userId);\n//console.log(userId, message,idUsu)\n\t\tconst usersCopy = [...users];\n\t\tconst newMsgObject = {\n\n\n\t\t\tsender:null,\n\t\t\tcontent: message,\n\t\t\treceiver:userId,\n\n\t\t\ttime: new Date().toLocaleTimeString(),\n\t\t\tstatus: \"delivered\",\n\t\t};\n\n\n\n\t\t//////////\n\n\t//\tconsole.log(newMsgObject);\n\n\t\tusersCopy[userIndex].messages.TODAY.push(newMsgObject);\n\t\tsetUsers(usersCopy);\n\n\t\tsocket.emit(\"sendMessage\", {userId,message,idUsu});\n\t};\n\n\n\treturn (\n\t\t<UsersContext.Provider value={{ users, setUserAsUnread, addNewMessage }}>\n\t\t\t{children}\n\t\t</UsersContext.Provider>\n\t);\n};\n\nexport { useUsersContext, UsersProvider };\n"]},"metadata":{},"sourceType":"module"}